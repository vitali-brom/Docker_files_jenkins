server {

        listen 443 ssl;

        root /var/www/playsdev.ddns.net/html;
        index index.html index.php;

        server_name playsdev.ddns.net;

        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        location / {
        try_files $uri $uri/ =404;
        }
#music
        location /music/ {

                autoindex on;
#                index sample-s3.mp3;

                add_header Content-Disposition '"attachment; filename="sample-s3.mp3"';
                add_header Content-Type audio/mp3;
        }

#Apache8080
        location /Apache-info/ {

                proxy_pass     http://127.0.0.1:8080/info.php;
#               proxy_pass      https://github.com;
       }

#secondserver
        location /secondserver/ {

                rewrite ^/secondserver(.*)$ https://barik.fvds.ru/ redirect;
       }

#redblue
        location /redblue/color.html {

                proxy_pass  http://redblue;
#               index color.html;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-NginX-Proxy true;

                proxy_send_timeout 20s;
                proxy_read_timeout 20s;
                proxy_connect_timeout 20s;

#               include proxy_params;
#               proxy_next_upstream_timeout 10s;
#               proxy_next_upstream_tries 1;
        }
#regex.jpg+rotate
        location ~ \.jpg$ {

                image_filter rotate 270;
        }

#image1
        location /image1/ {

                index image.jpg;
#                add_header Content-Type image/jpg;
        }

#image2
        location /image2/ {

                index png.png;
#                add_header Content-Type image/png;
        }

#monitoring
        location /monitoring/ {

                index monitor.php
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Real-IP $remote_addr;
        }

        location ~ \.php$ {

                include snippets/fastcgi-php.conf;
                fastcgi_pass  unix:/run/php/php7.4-fpm.sock;
        }



#Amplify
        location /nginx_status {
                proxy_pass      https://amplify.nginx.com/dashboard/;

                proxy_set_header Host      $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-NginX-Proxy true;
        }





#SSL
        ssl_certificate /etc/letsencrypt/live/playsdev.ddns.net/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/playsdev.ddns.net/privkey.pem;
#        include /etc/letsencrypt/options-ssl-nginx.conf;
#        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}





upstream redblue {
#       least_conn;

        server 52.14.37.220:80 max_conns=1 max_fails=1 fail_timeout=30s;
        server 18.222.91.48:80 max_fails=2 fail_timeout=10s;
}






server {
        listen 8008;
        server_name playsdev.ddns.net;

        access_log /var/log/nginx/8008-access.log custom;
        error_log /var/log/nginx/8008-error.log;

        root /var/www/playsdev.ddns.net;

        location / {
#               proxy_pass http://127.0.0.1:8008/monitor.php;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Real-IP $remote_addr;
        }


#       return 301 https://$host$request_uri;
#       return 404; # managed by Certbot
}






server {
        server_name playsdev.ddns.net:80;

        location / {

        rewrite ^/$ https://playsdev.ddns.net redirect;
#       proxy_redirect playsdev.ddns.net:443;
#        return 301 https://$host$request_uri:443;
        }
}
